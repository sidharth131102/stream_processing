project:
  id: stream-accelerator-2
  region: us-central1
  location: us-central1
apis:
- dataflow.googleapis.com
- pubsub.googleapis.com
- bigquery.googleapis.com
- storage.googleapis.com
- logging.googleapis.com
- composer.googleapis.com
- monitoring.googleapis.com
- artifactregistry.googleapis.com
- iam.googleapis.com
- cloudresourcemanager.googleapis.com
vpc_sc:
  enabled: false
  mode: dry_run
  perimeter_name: stream-accelerator-2-perimeter
  access_context:
    policy_id: null
  restricted_services:
  - storage.googleapis.com
  - bigquery.googleapis.com
  - pubsub.googleapis.com
  - dataflow.googleapis.com
  - artifactregistry.googleapis.com
  - composer.googleapis.com
  resources:
    projects:
    - stream-accelerator-2
  perimeter_type: REGULAR
  dry_run:
    enabled: true
    violations_log_only: true
  ingress_rules:
    allowed_identities: []
    allowed_resources: []
  egress_rules:
    allowed_services: []
    allowed_identities: []
service_account:
  name: dataflow-stream-sa
  display_name: Dataflow Streaming Service Account (Dev)
  roles:
  - roles/dataflow.worker
  - roles/pubsub.subscriber
  - roles/pubsub.publisher
  - roles/pubsub.viewer
  - roles/bigquery.dataEditor
  - roles/bigquery.jobUser
  - roles/storage.objectAdmin
  - roles/artifactregistry.reader
  - roles/dataflow.worker
storage:
  buckets:
  - name: stream-accelerator-2-config
    description: Configuration files storage
    files:
    - source: config/destination_mapping.yaml
      destination: destination_mapping.yaml
    - source: config/transformation.yaml
      destination: transformation.yaml
    - source: config/validation.yaml
      destination: validation.yaml
    - source: config/pipeline.yaml
      destination: pipeline.yaml
    - source: config/composer.yaml
      destination: composer.yaml
    - source: config/backfill.yaml
      destination: backfill.yaml
    vpc_sc:
      protected: true
      allow_public_access: false
  - name: stream-accelerator-2-dataflow
    description: Dataflow job artifacts
    folders:
    - staging
    - temp
    - templates
    vpc_sc:
      protected: true
  - name: stream-accelerator-2-archive
    description: Archived raw events
    folders:
    - events
    vpc_sc:
      protected: true
pipeline_configs:
  config_directory: config
  bucket: stream-accelerator-2-config
  files:
  - destination_mapping.yaml
  - transformation.yaml
  - validation.yaml
  - composer.yaml
  - pipeline.yaml
  - backfill.yaml
pubsub:
  schemas:
  - name: json_event_v2
    type: avro
    definition_file: schemas/json_event_v2.avsc
    payload_schema_file: schemas/json_event_v2.json
  topics:
  - name: json-events-topic
    description: Main events ingestion topic
    schema: json_event_v2
    message_encoding: json
    vpc_sc:
      protected: true
  - name: json-events-dlq
    description: Dead letter queue topic
    vpc_sc:
      protected: true
  - name: json-events-backfill-dlq
    description: Backfill dead letter queue topic
    vpc_sc:
      protected: true
  subscriptions:
  - name: json-events-sub
    topic: json-events-topic
    ack_deadline: 120
    max_delivery_attempts: 5
    dead_letter_topic: json-events-dlq
  - name: json-events-dlq-sub
    topic: json-events-dlq
    ack_deadline: 60
  - name: json-events-backfill-dlq-sub
    topic: json-events-backfill-dlq
    ack_deadline: 60
bigquery:
  datasets:
  - name: analytics
    description: Analytics dataset for processed events
    location: us-central1
    vpc_sc:
      protected: true
    tables:
    - name: service_requests
docker:
  registry:
    location: us-central1
    repository: dataflow-accelerators
  image:
    name: json-stream-accelerator
    tag: v164
    dockerfile: docker/Dockerfile
    context: .
dataflow:
  template:
    name: json-streaming-templ-new
    metadata_file: docker/metadata.json
    sdk_language: PYTHON
    storage_path: gs://stream-accelerator-2-dataflow/templates/json-streaming-templ-latest.json
  job:
    name_prefix: json-streaming
    worker_region: us-central1
    worker_zone: us-central1-a
    staging_location: gs://stream-accelerator-2-dataflow/staging
    temp_location: gs://stream-accelerator-2-dataflow/temp
    parameters:
      subscription: projects/stream-accelerator-2/subscriptions/json-events-sub
      config_bucket: stream-accelerator-2-config
      env: dev
      job_mode: streaming
    num_workers: 2
    max_workers: 10
    worker_machine_type: n2-standard-2
    disk_size_gb: 30
    autoscaling_algorithm: THROUGHPUT_BASED
    enable_streaming_engine: true
    experiments:
    - use_runner_v2
    - enable_vertical_autoscaling
streaming_tuning:
  dedup:
    enabled: true
    mode: single
    buffer_seconds: 30
    max_state_age_sec: 1800
  sharding:
    num_shards: 32
  windowing:
    enabled: true
    type: fixed
    window_size_sec: 60
    allowed_lateness_sec: 300
    archive_window_sec: 60
  batching:
    bigquery:
      enabled: false
      min_batch_size: 200
      max_batch_size: 1000
deployment:
  auto_increment_version: true
  cleanup_old_images: true
  max_image_versions: 5
  enable_monitoring: true
  enable_logging: true
control_planes:
  composer:
    config_bucket: stream-accelerator-2-config
    config_path: composer.yaml
orchestration:
  dags:
    streaming_start: dataflow_streaming_start
    streaming_stop: dataflow_streaming_stop
    rolling_deploy: dataflow_streaming_rolling_deploy
    recovery: failure_auto_recovery
raw_events:
  table: stream-accelerator-2.analytics.raw_events
schema_management:
  enabled: true
  scope: FULL_EVENT
  schema_name: json_event_v2
  schema_version: v2
  evolution_policy:
    on_new_field: ALLOW
    on_missing_field: WARN
    on_type_change: FAIL
  dlq_on_violation: true
observability:
  alerts:
    enabled: true
    email:
      address: sidharthunnikrishnan2002@gmail.com
security:
  cmek:
    enabled: false
    key_name: projects/PROJECT/locations/REGION/keyRings/RING/cryptoKeys/KEY
